{% extends "base.html" %}
{% load app_filters %}
{% load i18n %}
{% load static %}


{% block title %}{% trans "Thesaurus" %} | {{ block.super }}{% endblock %}


{% block breadcrumb %}
	{% if not object %}
		<li><a href="{% url 'list_qualifier' %}">{% trans "Thesaurus" %}</a>
		<span class="divider">/</span></li>
		<li>{% trans "New Qualifier" %}</li>
	{% else %}
        <li><a href="{% url 'list_qualifier' %}">{% trans "Thesaurus" %}</a>
        <span class="divider">/</span></li>
		<li>{% trans "Edit Qualifier" %}</li>
	{% endif %}
{% endblock %}


{% block content %}
<form name="actions">
    <input type="hidden" name="orderby" value="{{ actions.orderby }}">
    <input type="hidden" name="order" value="{{ actions.order }}">
    <input type="hidden" name="page" value="{{ actions.page }}">
    <input type='hidden' name="s"  value="{{ actions.s }}">
</form>


<!--  header -->
<div class='header'>
    <h2><i class='icon-book'></i>
    	{% if not object %}
    		{% trans "New Qualifier" %}
    		{% if next_id %}
    			 - ID: {{ next_id }}
    		{% endif %}

        {% else %}

            {% trans "Edit Qualifier" %}

            {% for qualif in formset_descriptor %}
                {% if qualifier_info == qualif.language_code.value %}
                    : {{ qualif.qualifier_name.value }}
                {% endif %}
            {% endfor %}
        {% endif %}</h2>

</div>

<div class='body'>    
    <ul class="nav nav-tabs" id='tab'>
            <li class="active">
                <a href="#tab-identifierqualif" data-toggle="tab"><strong>{% trans "Identifier" %}</strong></a>
            </li>
            <li class="">
                <a href="#tab-descriptionqualif" data-toggle="tab"><strong>{% trans "Description" %}</strong></a>
            </li>
            <li class="">
                <a href="#tab-treenumberslistqualif" data-toggle="tab"><strong>{% trans "Category" %}</strong></a>
            </li>
            <li class="">
                <a href="#tab-conceptlistqualif" data-toggle="tab"><strong>{% trans "Concept List" %}</strong></a>
            </li>

            <li class="">
                <a href="#tab-termlistqualif" data-toggle="tab"><strong>{% trans "Terms" %}</strong></a>
            </li>


    </ul>


    <form method="POST" enctype="multipart/form-data" class="act-form">
    {% csrf_token %}

        <div class="tab-content">

            <div id="tab-identifierqualif" class="tab-pane active">
                <fieldset id="identifierqualif">
                    {% for field in form.visible_fields %}
                        {% if field.errors %}
                            <font>Error : </font>{{ field.label }}{{ field.errors }}
                        {% endif %}
                    {% endfor %}
                    <table class="identifierqualif">
                        <thead>
                            <th>{{ form.thesaurus.label }}</th>
                            <th>{{ form.abbreviation.label }}</th>
                            <th>{{ form.active.label }}</th>
                        </thead>
                        <tr>
                            <td>{{ form.thesaurus }}</td>
                            <td><center>{{ form.abbreviation }}</center></td>
                            <td><center>{{ form.active }}</center></td>
                        </tr>
                        <thead>
                            <th>{{ form.qualifier_ui.label }}</th>
                            <th>{{ form.decs_code.label }}</th>
                            <th>{{ form.external_code.label }}</th>
                        </thead>
                        <tr>
                            <td>{{ form.qualifier_ui }}</td>
                            <td>{{ form.decs_code }}</td>
                            <td>{{ form.external_code }}</td>
                        </tr>
                        <thead>
                            <th>{{ form.date_created.label }}
                                <font color="#999"><i>{{ form.date_created.help_text }}</i></font>
                            </th>
                            <th>{{ form.date_revised.label }}
                                <font color="#999"><i>{{ form.date_revised.help_text }}</i></font>
                            </th>
                            <th>{{ form.date_established.label }}
                                <font color="#999"><i>{{ form.date_established.help_text }}</i></font>
                            </th>
                        </thead>
                        <tr>
                            <td>{{ form.date_created }}</td>
                            <td>{{ form.date_revised }}</td>
                            <td>{{ form.date_established }}</td>
                        </tr>
                    </table>
                </fieldset>
            </div>


            <div id="tab-descriptionqualif" class="tab-pane">
                <fieldset id="descriptionqualif">

                    {{ formset_descriptor.management_form }}
                    {% for form in formset_descriptor %}
                        {% for hidden in form.hidden_fields %}
                            {{ hidden }}
                        {% endfor %}

                    <table class="accordion-heading">
                        <a class="accordion-toggle" data-toggle="collapse" data-target="#descriptionqualif_{{ form.instance.pk }}">
                            <font size="2">
                                {% if form.instance.pk %}
                                    <font color="#333">
                                    {{ form.qualifier_name.value }} ({{ form.language_code.value }})
                                    </font>
                                {% else %}
                                    {% trans 'New Record' %}
                                {% endif %}
                            </font>
                        </a>
                    </table>

                    <div id="descriptionqualif_{{ form.instance.pk }}" class="panel-collapse collapse">


                        <table class="descriptionqualif">
                            <tr>

                            {% if form.instance.pk %}
                                <td colspan="4" class="td-r-del">
                                    {% trans 'Remove' %}? {{ form.DELETE }}
                                </td>
                            {% else %}
                                <td colspan="4" class="term-origin">&nbsp;
                                </td>
                            {% endif %}

                        <input name="{{descriptionqualif}}_DELETE" id="id_{{descriptionqualif}}_DELETE" type="hidden">

                                </td>
                            </tr>
                            <tr>
                                <td class="td-r">{{ form.qualifier_name.label_tag }}</td>
                                <td class="td-l">
                                {{ form.qualifier_name }}
                                </td>
                                <td class="td-r">{{ form.language_code.label_tag }}</td>
                                <td class="td-l">
                                {{ form.language_code }}
                                </td>
                            </tr>
                            <tr>
                                <td class="td-r" colspan="1">{{ form.annotation.label_tag }}</td>
                                <td colspan="3">
                                {{ form.annotation }}
                                </td>
                            </tr>
                            <tr>
                                <td class="td-r" colspan="1">{{ form.history_note.label_tag }}</td>
                                <td colspan="3">
                                {{ form.history_note }}
                                </td>
                            </tr>
                            <tr>
                                <td class="td-r" colspan="1">{{ form.online_note.label_tag }}</td>
                                <td colspan="3">
                                {{ form.online_note }}
                                </td>
                            </tr>
                            <tr>
                                <td class="td-r" colspan="1">{{ form.scope_note.label_tag }}</td>
                                <td colspan="3">
                                {{ form.scope_note }}
                                </td>
                            </tr>
                        </table>
                        <br>
                    </div>
                    {% endfor %}
                </fieldset>
            </div>


            <div id="tab-treenumberslistqualif" class="tab-pane">
                <div class="well">
                    {{ formset_category.as_p }}
                </div>
            </div>

            <div id="tab-conceptlistqualif" class="tab-pane">
                <div class="well">
                    {{ formset_concept.as_p }}
                </div>
            </div>


            <div id="tab-termlistqualif" class="tab-pane">
                <div class="well">
                    {{ formset_term.as_p }}
                </div>
            </div>

            <div class="control-panel form-submit">
                <button class="btn btn-primary btn-large">{% trans "Save" %}</button>
            </div>

        </div>

    </form>
</div>

{% endblock %}


{% block extrajs %}
   <script src="{% static 'js/jquery.formset.js' %}"></script>
   <script src="{% static 'js/bootstrap-datepicker.min.js' %}"></script>
   <script src="{% static 'js/bootstrap-collapse.js' %}"></script>

    <script type="text/javascript">
        $(function() {
            $('.act-form').on('submit', function() {
                if (confirm('{% trans "Save" %}?')) {
                    return true;
                } else {
                    return false;
                }
            });


            $('[id$="-DELETE"]').on('click', function() {
                val = $(this).val();
                if (confirm('{% trans "Delete" %}?')) {
                    return true;
                } else {
                    return false;

                }
            });

            
            // Alerta sobre n√£o preenchimento
            $('[id^="qualifiers-"]').on('blur', function() {
                val = $(this).val();
                if ( val == '' ){
                    alert('{% trans "Warning" %}');
                    return false;
                }
            });


        })
   </script>

{% endblock %}