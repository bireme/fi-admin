{% extends "base.html" %}
{% load app_filters %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Thesaurus" %} | {{ block.super }}{% endblock %}


{% block breadcrumb %}
	{% if not object %}
		<li><a href="{% url 'list_descriptor' %}">{% trans "Thesaurus" %}</a>
		<span class="divider">/</span></li>
		<li>{% trans "New Descriptor" %}</li>
	{% else %}
        <li><a href="{% url 'list_descriptor' %}">{% trans "Thesaurus" %}</a>
        <span class="divider">/</span></li>
		<li>{% trans "Edit Descriptor" %}</li>
	{% endif %}
{% endblock %}


{% block content %}
<form name="actions">
    <input type="hidden" name="orderby" value="{{ actions.orderby }}">
    <input type="hidden" name="order" value="{{ actions.order }}">
    <input type="hidden" name="page" value="{{ actions.page }}">
    <input type='hidden' name="s"  value="{{ actions.s }}">
</form>


<!--  header -->
<div class='header'>
    <h2><i class='icon-book'></i>
    	{% if not object %}
    		{% trans "New Descriptor" %}
    		{% if next_id %}
    			 - ID: {{ next_id }}
    		{% endif %}
    	{% else %}
    		{% trans "Edit Descriptor" %}

            {% for desc in formset_descriptor %}
                {% if descriptor_info == desc.language_code.value %}
                    : {{ desc.descriptor_name.value }}
                {% endif %}
            {% endfor %}

<!--     		{% if object.id %}
    			 - ID: {{ object.descriptor_ui }} - {{ object.decs_code }}
    		{% endif %}
 -->
    	{% endif %}</h2>


</div>

<div class='body'>    
    <ul class="nav nav-tabs" id='tab'>
            <li class="active">
                <a href="#tab-identifierdesc" data-toggle="tab"><strong>{% trans "Identifier" %}</strong></a>
            </li>
            <li class="">
                <a href="#tab-descriptiondesc" data-toggle="tab"><strong>{% trans "Description" %}</strong></a>
            </li>
            <li class="">
                <a href="#tab-treenumberslistdesc" data-toggle="tab"><strong>{% trans "Category" %}</strong></a>
            </li>
            <li class="">
                <a href="#tab-previousindexinglistdesc" data-toggle="tab"><strong>{% trans "Previous indexing" %}</strong></a>
            </li>
            <li class="">
                <a href="#tab-conceptlistdesc" data-toggle="tab"><strong>{% trans "Concept List" %}</strong></a>
            </li>

            <li class="">
                <a href="#tab-termlistdesc" data-toggle="tab"><strong>{% trans "Terms" %}</strong></a>
            </li>


    </ul>


    <form method="POST" class="form-horizontal" enctype="multipart/form-data">
    {% csrf_token %}

        <div class="tab-content">

            <div id="tab-identifierdesc" class="tab-pane active">
                <fieldset id="identifierdesc">
                    {% for field in form.visible_fields %}
                        {% if field.errors %}
                            <font>Error : </font>{{ field.label }}{{ field.errors }}
                        {% endif %}
                    {% endfor %}
                    <table class="identifierdesc">
                        <thead>
                            <th>{{ form.thesaurus.label }}</th>
                            <th>{{ form.active.label }}</th>
                        </thead>
                        <tr>
                            <td>{{ form.thesaurus }}</td>
                            <td><center>{{ form.active }}</center></td>
                        </tr>
                        <thead>
                            <th>{{ form.descriptor_ui.label }}</th>
                            <th>{{ form.decs_code.label }}</th>
                            <th>{{ form.external_code.label }}</th>
                            <th>{{ form.nlm_class_number.label }}</th>
                        </thead>
                        <tr>
                            <td>{{ form.descriptor_ui }}</td>
                            <td>{{ form.decs_code }}</td>
                            <td>{{ form.external_code }}</td>
                            <td>{{ form.nlm_class_number }}</td>
                        </tr>
                        <thead>
                            <th>{{ form.descriptor_class.label }}</th>
                            <th>{{ form.date_created.label }}
                                <font color="#999"><i>{{ form.date_created.help_text }}</i></font>
                            </th>
                            <th>{{ form.date_revised.label }}
                                <font color="#999"><i>{{ form.date_revised.help_text }}</i></font>
                            </th>
                            <th>{{ form.date_established.label }}
                                <font color="#999"><i>{{ form.date_established.help_text }}</i></font>
                            </th>
                        </thead>
                        <tr>
                            <td>{{ form.descriptor_class }}</td>
                            <td>{{ form.date_created }}</td>
                            <td>{{ form.date_revised }}</td>
                            <td>{{ form.date_established }}</td>
                        </tr>
                        <tr>
                            <td colspan=4>{{ form.abbreviation }}</td>
                        </tr>
                    </table>
                </fieldset>
            </div>

            <div id="tab-descriptiondesc" class="tab-pane">
                <fieldset id="descriptiondesc">
                    {{ formset_descriptor.management_form }}
                    {% for form in formset_descriptor %}
                        {% for hidden in form.hidden_fields %}
                            {{ hidden }}
                        {% endfor %}
                        <table class="descriptiondesc">
                            <tr>
                                <td colspan="4" class="term-origin">&nbsp;{{ form.descriptor_name.value }} ({{ form.language_code.value }})</td>
                            </tr>
                            <tr>
                                <td class="td-r">{{ form.descriptor_name.label_tag }}</td>
                                <td class="td-l">
                                {{ form.name.errors }}
                                {{ form.descriptor_name }}
                                </td>
                                <td class="td-r">{{ form.language_code.label_tag }}</td>
                                <td class="td-l">
                                {{ form.name.errors }}
                                {{ form.language_code }}
                                </td>
                            </tr>
                            <tr>
                                <td class="td-r" colspan="1">{{ form.annotation.label_tag }}</td>
                                <td colspan="3">
                                {{ form.name.errors }}
                                {{ form.annotation }}
                                </td>
                            </tr>
                            <tr>
                                <td class="td-r" colspan="1">{{ form.history_note.label_tag }}</td>
                                <td colspan="3">
                                {{ form.name.errors }}
                                {{ form.history_note }}
                                </td>
                            </tr>
                            <tr>
                                <td class="td-r" colspan="1">{{ form.online_note.label_tag }}</td>
                                <td colspan="3">
                                {{ form.name.errors }}
                                {{ form.online_note }}
                                </td>
                            </tr>
                            <tr>
                                <td class="td-r" colspan="1">{{ form.scope_note.label_tag }}</td>
                                <td colspan="3">
                                {{ form.name.errors }}
                                {{ form.scope_note }}
                                </td>
                            </tr>
                            <tr>
                                <td class="td-r" colspan="1">{{ form.public_mesh_note.label_tag }}</td>
                                <td colspan="3">
                                {{ form.name.errors }}
                                {{ form.public_mesh_note }}
                                </td>
                            </tr>
                            <tr>
                                <td class="td-r" colspan="1">{{ form.consider_also.label_tag }}</td>
                                <td colspan="3">
                                {{ form.name.errors }}
                                {{ form.consider_also }}
                                </td>
                            </tr>
                        </table>
                        <br>
                    {% endfor %}
                </fieldset>
            </div>


            <div id="tab-treenumberslistdesc" class="tab-pane">
                <fieldset id="treenumberslistdesc">

                    <table class="treenumberslistdesc">
                        <thead>
                            <th>{% trans "Tree Numbers List" %}</th>
                            <th>{% trans "Delete?" %}</th>
                        </thead>
                        <tbody>
                        {{ formset_category.management_form }}

                        {% for form in formset_category %}
                            {% for hidden in form.hidden_fields %}
                                {{ hidden }}
                            {% endfor %}
                            <tr id="category-{{ forloop.counter0 }}" class="category-row{% if form.errors %} error{% endif %} formset-row">
                                {% for field in form.visible_fields %}
                               <input type="hidden" id="{{ field.auto_id }}" name="{{ field.html_name }}" value="0" class="keep-field-value" />
                                <td>
                                    {{ field }}
                                    {{ field.errors }}
                                </td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </fieldset>
            </div>


            <div id="tab-previousindexinglistdesc" class="tab-pane">
                <div class="well">
                    {{ formset_previous.as_p }}
                </div>
            </div>

            <div id="tab-conceptlistdesc" class="tab-pane">
                <div class="well">
                    {{ formset_concept.as_p }}
                </div>
            </div>

            <div id="tab-termlistdesc" class="tab-pane">
                <div class="well">
                    {{ formset_term.as_p }}
                </div>
            </div>
        </div>

        <div class="control-panel form-submit">
            <button class="btn btn-primary btn-large">{% trans "Save" %}</button>
        </div>


    </form>

<!-- http://djangoweb.blogspot.com.br/2015/08/como-usar-o-filterhorizontalfilterverti.html#gpluscomments -->
 <script src="{% static "site/js/jquery.js" %}"></script>
 <script type="text/javascript" src="{% static "admin/js/jquery.init.js" %}"></script>
    <script type="text/javascript" src="/admin/jsi18n/"></script>
    <script type="text/javascript" src="{% static "admin/js/core.js" %}"></script>
    <script type="text/javascript" src="{% static "admin/js/SelectBox.js" %}"></script>
    <script type="text/javascript" src="{% static "admin/js/SelectFilter2.js" %}"></script>
    <script type="text/javascript">
     // PARAMETROS DO SELECT FILTER:
     // ID do seu elemento select
     // NAME do seu elemento select
     // 0 - para filter_horizontal / 1 para filter_vertical
     // Caminho do admin para source de imagens utilizadas

        addEvent(window, "load", function(e) {SelectFilter.init("id_abbreviation", "abbreviation", 1, "/static/admin/"); });
    </script>


</div>

{% endblock %}


{% block extrajs %}
   <script src="{% static 'js/jquery.formset.js' %}"></script>
   <script src="{% static 'js/bootstrap-datepicker.min.js' %}"></script>
   {% if LANGUAGE_CODE != 'en' %}
       <script src="{% static ''%}js/bootstrap-datepicker.{{LANGUAGE_CODE}}.min.js"></script>
   {% endif %}

   <script type="text/javascript">

        $(function() {
            $('.category-row').formset({
                    addText : '{% trans "Add Tree Number" %}',
                    deleteText: '{% trans "delete" %}',
                    addCssClass : 'icon-plus-sign btn',
                    deleteCssClass : 'btn',
                    keepFieldValues: '.keep-field-value',
                    formCssClass: 'category_formset',
                    prefix: '{{ formset_category.prefix }}'
            });

            $('[id^="id_treenumberslistdesc_set-"]').on('blur', function() {
                val = $(this).val();
                $(this).val(val.replace(/\s/g, ''));

                tam = val.length;
                // alert(tam);
                if( tam % 2 !== 0 ){
                    // É impar
                    // alert("Impar "+tam);
                    // Verifica quantidade de pontos
                    qtd_pontos = ((tam + 1) / 4) - 1;
                    // alert('Numero de pontos:'+qtd_pontos);
                    if ( !( (parseFloat(qtd_pontos) == parseInt(qtd_pontos)) && !isNaN(qtd_pontos) ) ) {
                        // alert("Não é inteiro"+qtd_pontos)
                        alert('{% trans "Atenção" %}: '+$(this).val());
                        return false
                    } else {
                        $(this).val;                        
                    }

                } else {
                    // É par - está errado
                    if ( tam != 0 ){
                        alert('{% trans "Atenção" %}: '+$(this).val());
                        return false
                    }
                }
            });

            $('.form-horizontal').on('submit', function() {
                // if (confirm('{% trans "Add Tree Number" %}')) {
                if (confirm('{% trans "Confirma gravação?" %}')) {
                    return true;
                } else {
                    return false;
                }
            });





        })

   </script>
{% endblock %}